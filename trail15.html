<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Walmart Smart App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="bg-gradient-to-b from-indigo-100 via-blue-50 to-white min-h-screen font-sans" x-data="appState()">
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-indigo-700">Walmart Smart App</h1>
      <nav class="space-x-4">
        <button @click="page = 'about'" :class="navClass('about')">About</button>
        <template x-if="!loggedIn">
          <>
            <button @click="page = 'login'" :class="navClass('login')">Login</button>
            <button @click="page = 'signup'" :class="navClass('signup')">Signup</button>
          </>
        </template>
        <template x-if="loggedIn">
          <button @click="page = 'scanner'" :class="navClass('scanner')">Scanner</button>
          <button @click="page = 'cart'" :class="navClass('cart')">Cart (<span x-text="cart.length"></span>)</button>
        </template>
      </nav>
    </div>
  </header>

  <main class="max-w-4xl mx-auto mt-8 px-4">
    <!-- Scanner Page -->
    <section x-show="page === 'scanner' && loggedIn" class="bg-white p-6 rounded-xl shadow-md">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold text-indigo-700">üì∏ Live Scanner</h2>
        <button @click="page = 'cart'" class="btn-warning text-sm">Cart (<span x-text="cart.length"></span>)</button>
      </div>
      <div id="interactive" class="viewport border rounded mb-4 overflow-hidden"></div>
      <input x-model="barcode" class="input" readonly />
      <button @click="lookupProduct" class="btn-primary mt-2">Search Product</button>
      <div class="mt-6 text-sm space-y-4" x-html="resultHtml"></div>
      <div x-show="productFound" class="mt-4 space-x-2">
        <button @click="addToCart" class="btn-success">Add to Cart</button>
        <button @click="resetScanner" class="btn-gray">Scan Again</button>
      </div>
    </section>

    <!-- About Page -->
    <section x-show="page === 'about'" class="bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-2 text-indigo-700">About Walmart Smart App</h2>
      <p class="text-gray-700 mb-2">
        Walmart Smart App helps you scan barcodes using your camera, get live product info from the internet, and manage your smart cart.
      </p>
    </section>

    <!-- Login Page -->
    <section x-show="page === 'login' && !loggedIn" class="bg-white p-6 rounded-xl shadow-md flex flex-col items-center">
      <h2 class="text-xl font-semibold mb-4 text-indigo-700">Login</h2>
      <input type="text" placeholder="Username" x-model="loginForm.username" class="input max-w-md" />
      <input type="password" placeholder="Password" x-model="loginForm.password" class="input max-w-md" />
      <button @click="doLogin" class="btn-primary max-w-md">Login</button>
    </section>

    <!-- Signup Page -->
    <section x-show="page === 'signup' && !loggedIn" class="bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-4 text-indigo-700">Signup</h2>
      <input type="text" placeholder="Name" x-model="signupForm.name" class="input" />
      <input type="text" placeholder="Contact Number" x-model="signupForm.contact" class="input" />
      <input type="text" placeholder="Username" x-model="signupForm.username" class="input" />
      <input type="password" placeholder="Password" x-model="signupForm.password" class="input" />
      <input type="password" placeholder="Confirm Password" x-model="signupForm.confirmPassword" class="input" />
      <button @click="doSignup" class="btn-success w-full mt-2">Signup</button>
    </section>

    <!-- Cart Page -->
    <section x-show="page === 'cart' && loggedIn" class="bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-4 text-indigo-700">üõí Cart</h2>
      <template x-if="cart.length === 0">
        <p>Your cart is empty.</p>
      </template>
      <template x-for="(item, index) in cart" :key="index">
        <div class="border-b pb-2 mb-2">
          <p><strong>Name:</strong> <span x-text="item.name"></span></p>
          <p><strong>Price:</strong> ‚Çπ<span x-text="item.price"></span></p>
          <div class="flex items-center mt-1">
            <button class="btn-danger" @click="removeFromCart(index)">-</button>
            <span class="px-3" x-text="item.qty"></span>
            <button class="btn-success px-2" @click="item.qty++">+</button>
          </div>
        </div>
      </template>
      <template x-if="cart.length > 0">
        <div>
          <p class="mt-4 font-bold">Total: ‚Çπ<span x-text="totalPrice"></span></p>
          <button @click="alert('üõçÔ∏è Payment gateway under development.')" class="btn-warning mt-4">Proceed to Payment</button>
        </div>
      </template>
    </section>
  </main>

  <style>
    .input { @apply border w-full p-2 rounded mb-2 bg-white; }
    .btn-primary { @apply bg-indigo-600 text-white w-full py-2 rounded hover:bg-indigo-700; }
    .btn-success { @apply bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700; }
    .btn-danger { @apply bg-red-500 text-white px-2 rounded; }
    .btn-warning { @apply bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded; }
    .btn-gray { @apply bg-gray-400 text-white px-4 py-2 rounded; }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <script>
    function appState() {
      return {
        page: 'about',
        loggedIn: false,
        barcode: '',
        resultHtml: '',
        productFound: false,
        currentProduct: null,
        cart: [],
        loginForm: { username: '', password: '' },
        signupForm: { name: '', contact: '', username: '', password: '', confirmPassword: '' },
        navClass(p) { return this.page === p ? 'text-white bg-indigo-600 px-3 py-1 rounded' : 'text-indigo-700 hover:underline'; },
        doLogin() {
          if (this.loginForm.username && this.loginForm.password) {
            this.loggedIn = true;
            this.page = 'scanner';
            this.initScanner();
          } else {
            alert('Fill in login credentials.');
          }
        },
        doSignup() {
          if (this.signupForm.password !== this.signupForm.confirmPassword) {
            alert('Passwords do not match!');
            return;
          }
          this.loggedIn = true;
          this.page = 'scanner';
          this.initScanner();
        },
        initScanner() {
          Quagga.init({
            inputStream: {
              type: "LiveStream",
              target: document.querySelector('#interactive'),
              constraints: { facingMode: "environment" },
            },
            decoder: {
              readers: ["ean_reader", "ean_8_reader", "code_128_reader", "upc_reader"]
            }
          }, (err) => {
            if (err) return console.error(err);
            Quagga.start();
          });
          Quagga.onDetected(data => {
            this.barcode = data.codeResult.code;
            Quagga.stop();
          });
        },
        async lookupProduct() {
          if (!this.barcode) return alert('No barcode found!');
          this.resultHtml = 'Searching...';
          try {
            const res = await fetch(`https://barcodes-lookup.p.rapidapi.com/?barcode=${this.barcode}`, {
              method: 'GET',
              headers: {
                'X-Rapidapi-Key': 'YOUR_API_KEY',
                'X-Rapidapi-Host': 'barcodes-lookup.p.rapidapi.com'
              }
            });
            const data = await res.json();
            const p = data.product;
            if (!p) throw new Error();
            this.resultHtml = `
              <div class='border p-4 rounded bg-gray-50'>
                <img src='${p.images?.[0] || ''}' class='w-full h-48 object-contain mb-2 border rounded' />
                <p><strong>üõí Title:</strong> ${p.title}</p>
                <p><strong>üè≠ Manufacturer:</strong> ${p.manufacturer || 'N/A'}</p>
                <p><strong>üìÑ Description:</strong> ${p.description || 'N/A'}</p>
                <p><strong>üí∞ Price:</strong> ${p.online_stores?.[0]?.price || 'N/A'} at 
                  <a href='${p.online_stores?.[0]?.url}' target='_blank' class='text-blue-600 underline'>Store</a>
                </p>
              </div>`;
            this.currentProduct = {
              name: p.title,
              price: parseFloat((p.online_stores?.[0]?.price || '0').replace(/[‚Çπ$,]/g, '')) || 100,
              qty: 1
            };
            this.productFound = true;
          } catch {
            this.resultHtml = '<div class="text-red-600">‚ùå Product not found or API error.</div>';
            this.productFound = false;
          }
        },
        addToCart() {
          if (this.currentProduct) {
            this.cart.push({ ...this.currentProduct });
            this.productFound = false;
            this.barcode = '';
            this.resultHtml = '';
          }
        },
        resetScanner() {
          this.barcode = '';
          this.resultHtml = '';
          this.productFound = false;
          this.initScanner();
        },
        removeFromCart(index) {
          if (this.cart[index].qty > 1) {
            this.cart[index].qty--;
          } else {
            this.cart.splice(index, 1);
          }
        },
        get totalPrice() {
          return this.cart.reduce((total, item) => total + item.qty * item.price, 0);
        }
      }
    }
  </script>
</body>

</html>
